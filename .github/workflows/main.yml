name: CI - Calidad de Código

on:
    workflow_dispatch:
#    push:
#        branches: ["develop"]
#    pull_request:
#        branches: ["develop"]
#pull_request:
#    branches: ["main", "develop"]
#    paths:
#        - "api/**"
#        - "ui/**"

jobs:
    # 1. Validar Backend (NestJS)
    test-backend:
        name: Backend (Lint & Test)
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: ./api
        steps:
            - uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"
                  cache-dependency-path: api/package-lock.json

            - name: Install Dependencies
              run: npm ci

            - name: Run Linter
              run: npm run lint

            - name: Run Unit Tests
              run: npm test

    # 2. Validar Frontend (React Native)
    test-frontend:
        name: Frontend (Lint & TS Check)
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: ./ui
        steps:
            - uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"
                  cache-dependency-path: ui/package-lock.json

            - name: Install Dependencies
              run: npm ci

            - name: Run Linter
              # Esto verifica que no tengas errores de estilo o variables sin usar
              run: npm run lint

            - name: TypeScript Check
              # Esto verifica que no haya errores de tipos (super útil antes de compilar)
              # Si NO usas TypeScript en el front, borra estas dos líneas:
              run: npx tsc --noEmit --skipLibCheck
